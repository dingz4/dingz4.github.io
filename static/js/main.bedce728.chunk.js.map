{"version":3,"sources":["utils/index.ts","utils/http.ts","utils/use-async.ts","components/error-boundary.tsx","App.tsx","reportWebVitals.ts","context/index.tsx","index.tsx","auth-provider.ts","context/auth-context.tsx","components/lib.tsx"],"names":["cleanObject","object","result","Object","keys","forEach","key","value","undefined","isVoid","useMount","callback","useEffect","useDebounce","delay","useState","debounceValue","setDebounceValue","timeout","setTimeout","clearTimeout","useDocumentTitle","title","keepOnUnmount","oldTitle","useRef","document","current","resetRoute","window","location","href","origin","subset","obj","filteredEntries","entries","filter","includes","fromEntries","useMountedRef","mountedRef","apiUrl","process","REACT_APP_API_URL","http","endpoint","a","data","token","headers","customConfig","config","method","Authorization","toUpperCase","qs","stringify","body","JSON","fetch","then","response","status","auth","reload","Promise","reject","message","json","ok","useHttp","user","useAuth","useCallback","defaultInitialState","stat","error","defaultConfig","throwOnError","useAsync","initialState","initialConfig","useReducer","state","action","safeDispatch","dispatch","useSafeDispatch","retry","setRetry","setData","setError","run","promise","runConfig","Error","catch","isIdle","isLoading","isError","isSuccess","ErrorBoundary","this","props","fallbackRender","children","React","Component","AuthenticatedApp","lazy","UnauthenticatedApp","App","className","FullPageErrorFallback","Suspense","fallback","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","AppProviders","QueryClientProvider","client","QueryClient","loadServer","ReactDOM","render","StrictMode","getElementById","localStorageKey","getToken","localStorage","getItem","handleUserResponse","setItem","login","register","logout","removeItem","AuthContext","createContext","displayName","bootstrapUser","AuthProvider","setUser","queryClient","useQueryClient","Provider","form","clear","context","useContext","Row","styled","div","between","marginBottom","gap","FullPage","FullPageLoading","size","ErrorBox","Text","type","ButtonNoPadding","Button","ScreenContainer"],"mappings":"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","file":"static/js/main.bedce728.chunk.js","sourcesContent":["import {useEffect, useRef, useState} from \"react\";\r\n\r\nexport const isFalsy = (value:any) => (value === 0 ? false : !value);\r\nexport const isVoid = (value: unknown) => value === undefined || value === null || value === \"\";\r\n    // 在一个函数里，改变传入的对象本身是不好的\r\nexport const cleanObject = (object?:{[key: string]: unknown}) => {\r\n    if (!object) {\r\n        return {}\r\n    }\r\n     // Object.assign({}, object)\r\n    const result = { ...object };\r\n    Object.keys(result).forEach((key) => {\r\n        //@ts-ignore\r\n        const value = result[key];\r\n        if (isVoid(value)) {\r\n            delete result[key];\r\n        }\r\n    });\r\n    return result;\r\n};\r\n\r\nexport const useMount = (callback:() => void) => {\r\n    useEffect(() => {\r\n       callback()\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [])\r\n}\r\n\r\nexport const useDebounce = <V>(value:V, delay?:number) => {\r\n    const [debounceValue, setDebounceValue] = useState(value)\r\n    useEffect(() => {\r\n        //每次value变化完设置一个\r\n        const timeout = setTimeout(() => setDebounceValue(value),delay)\r\n        //每次在上一个useEffect处理完后在使用\r\n        return () => clearTimeout(timeout)\r\n    }, [value, delay])\r\n    return debounceValue\r\n}\r\n\r\nexport const useDocumentTitle = (title: string, keepOnUnmount:boolean =  true) => {\r\n    const oldTitle = useRef(document.title).current\r\n    //页面加载时候 旧title\r\n    //加载后 新title\r\n    useEffect(() => {\r\n        document.title = title\r\n    }, [title])\r\n\r\n    useEffect(() => {\r\n        return () => {\r\n            if(!keepOnUnmount) {\r\n                document.title = oldTitle\r\n            }\r\n        }\r\n    }, [keepOnUnmount, oldTitle])\r\n}\r\n\r\nexport const resetRoute = () => (window.location.href = window.location.origin);\r\n\r\n/**\r\n * 传入一个对象，和键集合，返回对应的对象中的键值对\r\n * @param obj\r\n * @param keys\r\n */\r\nexport const subset = <\r\n    O extends { [key in string]: unknown },\r\n    K extends keyof O\r\n    >(\r\n    obj: O,\r\n    keys: K[]\r\n) => {\r\n    const filteredEntries = Object.entries(obj).filter(([key]) =>\r\n        keys.includes(key as K)\r\n    );\r\n    return Object.fromEntries(filteredEntries) as Pick<O, K>;\r\n};\r\n/**返回组建的挂载状态， 如果还没挂载或者已经卸载，返回false，反之，返回true\r\n *\r\n */\r\nexport const useMountedRef = () => {\r\n    const mountedRef = useRef(false)\r\n\r\n    useEffect(() => {\r\n        mountedRef.current = true\r\n        return () => {\r\n            mountedRef.current = false\r\n        }\r\n    })\r\n    return mountedRef\r\n}","import qs from \"querystring\";\r\nimport * as auth from \"auth-provider\";\r\nimport { useAuth } from \"context/auth-context\";\r\nimport {useCallback} from \"react\";\r\n\r\nconst apiUrl = process.env.REACT_APP_API_URL;\r\n\r\ninterface Config extends RequestInit {\r\n    token?: string;\r\n    data?: object;\r\n}\r\n\r\nexport const http = async (\r\n    endpoint: string,\r\n    { data, token, headers, ...customConfig }: Config = {} ) => {\r\n    const config = {\r\n        method: \"GET\",\r\n        headers: {\r\n            Authorization: token ? `Bearer ${token}` : \"\",\r\n            \"Content-Type\": data ? \"application/json\" : \"\",\r\n        },\r\n        ...customConfig,\r\n    };\r\n\r\n    if (config.method.toUpperCase() === \"GET\") {\r\n        // @ts-ignore\r\n        endpoint += `?${qs.stringify(data)}`;\r\n    } else {\r\n        config.body = JSON.stringify(data || {});\r\n    }\r\n\r\n    // 别忘了axios 和 fetch 表现不一样，axios可以直接在返回状态不为2xx的时候抛出异常\r\n    return window\r\n        .fetch(`${apiUrl}/${endpoint}`, config)\r\n        .then(async (response) => {\r\n            if (response.status === 401) {\r\n                await auth.logout();\r\n                window.location.reload();\r\n                return Promise.reject({ message: \"请重新登录\" });\r\n            }\r\n            const data = await response.json();\r\n            if (response.ok) {\r\n                return data;\r\n            } else {\r\n                return Promise.reject(data);\r\n            }\r\n        });\r\n};\r\n\r\nexport const useHttp = () => {\r\n    const { user } = useAuth();\r\n    return useCallback((...[endpoint, config]: Parameters<typeof http>) =>\r\n        http(endpoint, { ...config, token: user?.token }), [user?.token]);\r\n};\r\n","import {useCallback, useReducer, useState} from \"react\";\r\nimport {useMountedRef} from \"./index\";\r\n\r\n\r\ninterface State<D> {\r\n    error: Error | null;\r\n    data: D | null;\r\n    stat: 'idle' | 'loading' | 'error' | 'success'\r\n}\r\n\r\nconst defaultInitialState: State<null> = {\r\n    stat:'idle',\r\n    data: null,\r\n    error: null\r\n}\r\n\r\nconst defaultConfig =  {\r\n    throwOnError:false\r\n}\r\n\r\nconst useSafeDispatch = <T>(dispatch: (...args: T[]) => void) => {\r\n    const mountedRef = useMountedRef()\r\n    return useCallback((...args: T[]) => (mountedRef.current ? dispatch(...args) : void 0), [dispatch, mountedRef])\r\n}\r\nexport const useAsync = <D>(initialState?: State<D>, initialConfig?: typeof  defaultConfig) => {\r\n    const config = {...defaultConfig, ...initialConfig}\r\n    const [state, dispatch] = useReducer((state:State<D>, action:Partial<State<D>>) => ({...state, ...action}),{\r\n        ...defaultInitialState,\r\n        ...initialState\r\n    })\r\n    const safeDispatch = useSafeDispatch(dispatch)\r\n    const [retry, setRetry] = useState(() => () => {\r\n\r\n    })\r\n\r\n    const setData = useCallback((data: D) => safeDispatch({\r\n         data,\r\n        stat: 'success',\r\n        error: null\r\n    }), [safeDispatch])\r\n\r\n    const setError = useCallback((error:Error) => safeDispatch({\r\n        error,\r\n        stat: 'error',\r\n        data: null\r\n    }), [safeDispatch])\r\n    //run 用来触发异步请求\r\n    const run = useCallback((\r\n        (promise: Promise<D>, runConfig?: {retry: () => Promise<D>}) => {\r\n            if (!promise || !promise.then) {\r\n                throw new Error('请传入Promise类型数据')\r\n            }\r\n            setRetry(() => () => {\r\n                if (runConfig?.retry) {\r\n                    run(runConfig?.retry(), runConfig)\r\n                }\r\n            })\r\n            safeDispatch({stat:'loading'})\r\n            return promise.then(data => {\r\n                setData(data)\r\n                return data\r\n            }).catch(error => {\r\n                // catch会消化异常，如果不抛出，外面收不到\r\n                setError(error)\r\n                if (config.throwOnError) Promise.reject(error);\r\n                return error;\r\n            })\r\n        }\r\n    ), [config.throwOnError, setData, setError])\r\n\r\n    return {\r\n        isIdle:state.stat === 'idle',\r\n        isLoading: state.stat === 'loading',\r\n        isError:state.stat === 'error',\r\n        isSuccess: state.stat === 'success',\r\n        run,\r\n        setData,\r\n        setError,\r\n        //retry调用后再跑一边run\r\n        retry,\r\n        ...state\r\n    }\r\n}","import React from \"react\";\r\n\r\ntype FallbackRender = (props: { error: Error | null }) => React.ReactElement;\r\n\r\n// https://github.com/bvaughn/react-error-boundary\r\nexport class ErrorBoundary extends React.Component<\r\n    React.PropsWithChildren<{ fallbackRender: FallbackRender }>, { error: Error | null }> {\r\n    state = { error: null };\r\n\r\n    // 当子组件抛出异常，这里会接收到并且调用\r\n    static getDerivedStateFromError(error: Error) {\r\n        return { error };\r\n    }\r\n\r\n    render() {\r\n        const { error } = this.state;\r\n        const { fallbackRender, children } = this.props;\r\n        if (error) {\r\n            return fallbackRender({ error });\r\n        }\r\n        return children;\r\n    }\r\n}","import React from 'react';\nimport './App.css';\nimport {useAuth} from \"./context/auth-context\";\nimport {ErrorBoundary} from \"./components/error-boundary\";\nimport {FullPageErrorFallback, FullPageLoading} from \"./components/lib\";\n\nconst AuthenticatedApp = React.lazy(() => import(\"authenticated-app\"))\nconst UnauthenticatedApp = React.lazy(() => import(\"unauthenticated-app\"))\n\nfunction App() {\n    const { user } = useAuth();\n    return (\n        <div className=\"App\">\n            <ErrorBoundary fallbackRender={FullPageErrorFallback}>\n                <React.Suspense fallback={<FullPageLoading/>}>\n                    {user ? <AuthenticatedApp /> : <UnauthenticatedApp />}\n                </React.Suspense>\n            </ErrorBoundary>\n        </div>\n    );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React, { ReactNode } from \"react\";\r\nimport { AuthProvider } from \"context/auth-context\";\r\nimport {QueryClientProvider, QueryClient} from \"react-query\";\r\nimport { BrowserRouter as Router} from \"react-router-dom\";\r\n\r\n\r\nexport const AppProviders = ({ children }: { children: ReactNode }) => {\r\n    return (\r\n    <QueryClientProvider client={new QueryClient()}>\r\n        <Router>\r\n            <AuthProvider>{children}</AuthProvider>;\r\n        </Router>\r\n    </QueryClientProvider>\r\n    )\r\n};","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport App from \"./App\";\r\nimport reportWebVitals from \"./reportWebVitals\";\r\nimport {loadServer, DevTools } from \"jira-dev-tool\";\r\nimport { AppProviders } from \"context\";\r\nimport 'antd/dist/antd.less'\r\n\r\nloadServer(() =>\r\n    ReactDOM.render(\r\n        <React.StrictMode>\r\n            <AppProviders>\r\n                <DevTools/>\r\n                <App />\r\n            </AppProviders>\r\n        </React.StrictMode>,\r\n        document.getElementById(\"root\")\r\n    )\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n","import {User} from \"./types/user\";\r\n//等供应商接入auth\r\nconst localStorageKey = '__auth_provider_token__'\r\n\r\nexport const getToken = () => window.localStorage.getItem(localStorageKey)\r\nconst apiUrl = process.env.REACT_APP_API_URL\r\n\r\nexport const handleUserResponse = ({user}: {user: User}) => {\r\n    window.localStorage.setItem(localStorageKey, user.token || '')\r\n    return user\r\n}\r\n\r\nexport const login = (data: {username: string, password: string}) => {\r\n    return fetch(`${apiUrl}/login`, {\r\n        method: 'POST',\r\n        headers:{\r\n            'Content-Type':'application/json'\r\n        },\r\n        body: JSON.stringify(data)\r\n    }).then(\r\n        async (response) => {\r\n            if (response.ok) {\r\n                return handleUserResponse(await response.json());\r\n            } else {\r\n                return Promise.reject(await response.json() );\r\n            }\r\n        }\r\n    )\r\n}\r\n\r\nexport const register = (data: { username: string; password: string }) => {\r\n    return fetch(`${apiUrl}/register`, {\r\n        method: \"POST\",\r\n        headers: {\r\n            \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify(data),\r\n    }).then(\r\n        async (response) => {\r\n        if (response.ok) {\r\n            return handleUserResponse(await response.json());\r\n        } else {\r\n            return Promise.reject(await response.json());\r\n        }\r\n    });\r\n};\r\n\r\nexport const logout = async() =>  window.localStorage.removeItem(localStorageKey)","import React, {  ReactNode } from \"react\";\r\nimport * as auth from \"../auth-provider\";\r\nimport {useMount} from \"../utils\";\r\nimport {http} from \"utils/http\";\r\nimport {useAsync} from \"../utils/use-async\";\r\nimport {FullPageErrorFallback} from \"../components/lib\";\r\nimport {useQueryClient} from \"react-query\";\r\nimport {User} from \"../types/user\";\r\n\r\ninterface AuthForm {\r\n    username: string;\r\n    password: string;\r\n}\r\n\r\nconst AuthContext = React.createContext<\r\n    | {\r\n    user: User | null;\r\n    register: (form: AuthForm) => Promise<void>;\r\n    login: (form: AuthForm) => Promise<void>;\r\n    logout: () => Promise<void>;\r\n}\r\n    | undefined\r\n    >(undefined);\r\nAuthContext.displayName = \"AuthContext\";\r\n\r\nconst bootstrapUser = async () => {\r\n    let user = null\r\n    const token = auth.getToken()\r\n    if (token) {\r\n        const data = await http('me', {token})\r\n        user = data.user\r\n    }\r\n    return user\r\n}\r\n\r\nexport const AuthProvider = ({ children }: { children: ReactNode }) => {\r\n    const {data: user, error, isLoading, isIdle, isError, run, setData: setUser} = useAsync<User | null>();\r\n    const queryClient = useQueryClient()\r\n    // point free\r\n    const login = (form: AuthForm) => auth.login(form).then(setUser);\r\n    const register = (form: AuthForm) => auth.register(form).then(setUser);\r\n    const logout = () => auth.logout().then(() => {\r\n        setUser(null)\r\n        queryClient.clear()\r\n    });\r\n    useMount(() => {\r\n        run(bootstrapUser())\r\n    })\r\n    if (isIdle || isLoading) {\r\n        return <p>loading...</p>\r\n    }\r\n    if (error) {\r\n        return <FullPageErrorFallback error={error}/>\r\n    }\r\n\r\n    return <AuthContext.Provider children={children} value={{ user, login, register, logout }}/>\r\n}\r\n\r\nexport const useAuth = () => {\r\n    const context = React.useContext(AuthContext);\r\n    if (!context) {\r\n        throw new Error(\"useAuth必须在AuthProvider中使用\");\r\n    }\r\n    return context;\r\n};","import styled from \"@emotion/styled\";\r\nimport React from \"react\";\r\nimport { Button, Spin, Typography } from \"antd\";\r\nimport {DevTools} from \"jira-dev-tool\"\r\nexport const Row = styled.div<{\r\n    gap?: number | boolean;\r\n    between?: boolean;\r\n    marginBottom?: number;\r\n}>`\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: ${(props) => (props.between ? \"space-between\" : undefined)};\r\n  margin-bottom: ${(props) => props.marginBottom + \"rem\"};\r\n  > * {\r\n    margin-top: 0 !important;\r\n    margin-bottom: 0 !important;\r\n    margin-right: ${(props) =>\r\n            typeof props.gap === \"number\"\r\n                    ? props.gap + \"rem\"\r\n                    : props.gap\r\n                    ? \"2rem\"\r\n                    : undefined};\r\n  }\r\n`;\r\n\r\nconst FullPage = styled.div`\r\n  height: 100vh;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n`;\r\n\r\nexport const FullPageLoading = () => (\r\n    <FullPage>\r\n        <Spin size={\"large\"} />\r\n    </FullPage>\r\n);\r\n\r\nexport const FullPageErrorFallback = ({ error }: { error: Error | null }) => (\r\n    <FullPage>\r\n        <DevTools/>\r\n        <ErrorBox error={error}/>\r\n    </FullPage>\r\n);\r\n\r\n\r\nconst isError = (value: any): value is Error => value?.message\r\n\r\nexport const ErrorBox = ({error}: {error: unknown}) => {\r\n    if (isError(error)) {\r\n        return <Typography.Text type={\"danger\"}>{error?.message}</Typography.Text>\r\n    }\r\n    return null;\r\n}\r\n\r\nexport const ButtonNoPadding = styled(Button)`\r\n  padding: 0;\r\n`;\r\n\r\nexport const ScreenContainer = styled.div `\r\n  padding: 3.2rem;\r\n  width: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n`"],"sourceRoot":""}